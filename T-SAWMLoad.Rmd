```{r SL_load_packages, include = FALSE}
library(papaja)
library(reshape)
library(dplyr)
library(afex)
library(emmeans)
library(multcomp)
library(stringi)
library(xtable)
library(doBy)
library(Hmisc)
library(corrplot)
library(knitr)
library(gdata)
library(cowplot)
```

```{r SL_helperFunctions, echo = FALSE, warning=FALSE}
corstars <-function(x, method=c("pearson", "spearman"), removeTriangle=c("upper", "lower"),
                     result=c("none", "html", "latex")){
    #Compute correlation matrix
    require(Hmisc)
    x <- as.matrix(x)
    correlation_matrix<-rcorr(x, type=method[1])
    R <- correlation_matrix$r # Matrix of correlation coeficients
    p <- correlation_matrix$P # Matrix of p-value 
    
    ## Define notions for significance levels; spacing is important.
    mystars <- ifelse(p < .001, "****", ifelse(p < .01, "*** ", ifelse(p < .05, "**  ", ifelse(p < .1, "*   ", "    "))))
    
    ## trunctuate the correlation matrix to two decimal
    R <- format(round(cbind(rep(-1.11, ncol(x)), R), 2))[,-1]
    
    ## build a new matrix that includes the correlations with their apropriate stars
    Rnew <- matrix(paste(R, mystars, sep=""), ncol=ncol(x))
    diag(Rnew) <- paste(diag(R), " ", sep="")
    rownames(Rnew) <- colnames(x)
    colnames(Rnew) <- paste(colnames(x), "", sep="")
    
    ## remove upper triangle of correlation matrix
    if(removeTriangle[1]=="upper"){
      Rnew <- as.matrix(Rnew)
      Rnew[upper.tri(Rnew, diag = TRUE)] <- ""
      Rnew <- as.data.frame(Rnew)
    }
    
    ## remove lower triangle of correlation matrix
    else if(removeTriangle[1]=="lower"){
      Rnew <- as.matrix(Rnew)
      Rnew[lower.tri(Rnew, diag = TRUE)] <- ""
      Rnew <- as.data.frame(Rnew)
    }
    
    ## remove last column and return the correlation matrix
    Rnew <- cbind(Rnew[1:length(Rnew)-1])
    if (result[1]=="none") return(Rnew)
    else{
      if(result[1]=="html") print(xtable(Rnew), type="html")
      else print(xtable(Rnew), type="latex") 
    }
} 

jTTest <-function(dataSheet, ConditionOne, ConditionTwo,N){
  D <- mean(dataSheet[[ConditionOne]]-dataSheet[[ConditionTwo]])
  se <- sqrt((N-1/N)*sum(((dataSheet$ConditionOne-dataSheet$ConditionTwo)-D)^2))
  Tvalue <- D/se
  jResult <- data.frame(D,se,Tvalue)
  return(jResult)
}
```

```{r analysis_setup, echo=FALSE}
# Seed for random number generation
set.seed(4609948)
# Load the behavioral data along with the subtracted data
#subData <-read.table("P:/dhen061/Experiment_1/EEG_Data/RAW_Files/Output-Final/Subtracted/SubtractedStatsAll.txt", header = TRUE)
subData <-read.table("Data/SL_SubtractedStatsAll.txt", header = TRUE)
# Divides data up into subsets
distData = subset(subData, select = c(1,2,3,4,5,6,7,8))
targData = subset(subData, select = c(9,10,11,12,13,14,15,16))
behavData = subset(subData, select = c(17,18,19,20,21,22,23,24))
highAreaData = subset(subData, select = c(17,21,19,23,26,30,25,29))
lowAreaData = subset(subData, select = c(18,22,20,24,28,32,27,31))
highLatData <- subset(subData, select = c(17,21,19,23, 37,38,41,42))
lowLatData <- subset(subData, select = c(18,22,20,24, 39,40,43,44))
latData <- subset(subData, select = c(37,38,41,42, 39,40,43,44))

# Add participant ID column to each subset
PID = c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20)
distData$PID = PID
targData$PID = PID
behavData$PID = PID
latData$PID = PID

# Convert accuracies to %
behavData$WM_High_Acc = behavData$WM_High_Acc*100
behavData$WM_Low_Acc = behavData$WM_Low_Acc*100
behavData$VS_High_Acc = behavData$VS_High_Acc*100
behavData$VS_Low_Acc = behavData$VS_Low_Acc*100

# Convert from wide to long form dataframe
longDist = melt(distData, id="PID")
longTarg = melt(targData, id="PID")
longBehav = melt(behavData, id="PID")
longLat =melt(latData, id="PID")

# Create Task, Load, and Measure columns for bahveioural data
longBehav$Task <- substr(longBehav$variable,start=1,stop=2)
longBehav = mutate(longBehav, Measure = substr(variable, start=nchar(as.character(variable))-2, stop=nchar(as.character(variable))))
longBehav = mutate(longBehav, Load = substr(variable, start=nchar(as.character(variable))-6, stop=nchar(as.character(variable))-4))
#Tidy the variable names
longBehav$Measure[longBehav$Measure == "_RT"] <- "RT"
longBehav$Load[longBehav$Load == "igh"] <- "High"
longBehav$Load[longBehav$Load == "Hig"] <- "High"
longBehav$Load[longBehav$Load == "_Lo"] <- "Low"

# Create a Load and Variable column
longDist$Load = substr(longDist$variable,start=6,stop=9)
longDist = mutate(longDist, Component = substr(variable, start=nchar(as.character(variable))-3, stop=nchar(as.character(variable))))
# Tidy the variable Names
longDist$Component[longDist$Component == "_Ptc"] <- "Ptc"
longDist$Component[longDist$Component == "SPCN"] <- "SPCNa"
longDist$Component[longDist$Component == "PCN2"] <- "SPCNb"
longDist$Load[longDist$Load == "Low_"] <- "Low"
 
# Do the same for targets
longTarg$Load = substr(longTarg$variable,start=6,stop=9)
longTarg = mutate(longTarg, Component = substr(variable, start=nchar(as.character(variable))-3, stop=nchar(as.character(variable))))
# Tidy columns
longTarg$Component[longTarg$Component == "SPCN"] <- "SPCNa"
longTarg$Component[longTarg$Component == "PCN2"] <- "SPCNb"
longTarg$Load[longTarg$Load == "Low_"] <- "Low"

# Do the same for latencies
longLat$Load = substr(longLat$variable,start=1,stop=1)
longLat$Stim = substr(longLat$variable,start=2,stop=5)
longLat$Sign = substr(longLat$variable,start=7,stop=7)

# Delete redundant column
longDist$variable <- NULL
longTarg$variable <- NULL
longBehav$variable <- NULL
longLat$variable <- NULL
```

## Prologue

\textit{Study One} gave us a detailed understanding of how subtle differences in the design of a change detection task can affect participant performance. In \textit{Study Two} we wanted to use EEG measures of attention in order to be more specific about the relationship between attention processing and working memory availability. Our idea was to use a dual task format where participants would perform a change detection task and an attention based task simultaneously. We could then vary the working memory load on the change detection task while recording the concomitant effects in the neural response to the attention task. Previous work had established some ideal neural measures of the attention processes that we wanted to dissociate, and therefore the attention task was based on designs from those studies. For the change detection task, we decided to use a version which was most equivalent to the target-inverse blocks from \textit{Study One}. \textit{Study One} showed that these blocks produced robust working memory effects and we had observed no significant differences in performance between target-inverse blocks and fixed distractor blocks. This version of the change detection task also had the added benefit of keeping the number of stimuli on screen consistent across all trials, which is ideal for EEG studies where the number of stimuli on screen can have significant effects on neural responses. 

\newpage

## Introduction

Everyday situations such as grocery shopping and driving depend on our ability to both efficiently allocate attention to relevant objects while suppressing distraction, as well as maintain and retrieve information from working memory. Although research over the past decade has demonstrated significant functional overlap between attention and working memory, the multifaceted nature of the relationship between these two constructs is not well understood [@fougnie_relationship_2008;@de_fockert_beyond_2013]. Converging evidence suggests that when load on a concurrent working memory task is increased, performance on an attention task is subject to increased interference from irrelevant distractors [@ahmed_focusing_2012;@de_fockert_role_2001;@stins_role_2004]. There is also evidence that individuals low in working memory capacity show greater interference on a standard Stroop task [@kane_working-memory_2003], as well as greater interference on an Eriksen flanker task [@shipstead_working_2012]. Taken together, these findings suggest that the relationship between selective attention and working memory may be better framed in terms of working memory availability. From this perspective, increasing the working memory load on an individual would lead to a decrease in their working memory availability. What's more, individuals with low working memory capacity would have less overall available working memory than with high working memory capacity (see @de_fockert_beyond_2013 for a review).

Contemporary accounts of working memory availability now typically incorporate attentional control either as an important contributor to working memory capacity[@kane_controlled-attention_2001; @shipstead_mechanisms_2014], or in some cases as the primary determinant of working memory capacity [@engle_working_2018]. The question of why working memory availability is important for selective attention remains unanswered. The aim of this research was to specify the relationship between selective attention and working memory by recording electrophysiological indices of attentional control under varying working memory load.

Optimal performance of selective attention relies on several underlying processes including; target identification and selection, proactive suppression of possible distractors, and efficient disengagement from irrelevant distractors that capture attention [@carrasco_visual_2011]. Evidence for the effects of low working memory availability on attentional interference is equivocal, and interference with any one of these processes would produce impaired behavioral performance associated with low working memory availability. Some evidence suggests that low working memory availability delays the speed with which individuals can deploy attention to relevant targets [@heitz_focusing_2007; @scalf_working_2011]. Yet, findings from other work suggest that low working memory availability may cause an increase in capture by irrelevant distractors [@fukuda_human_2009; @vogel_neural_2005].

A different account was proposed by @fukuda_individual_2011 in research using both psychophysical and electrophysiological measures of recovery from attentional capture in low and high capacity individuals. Findings from this work suggest that the two groups are equally prone to initial capture of attention, but that availability of working memory allows more efficient disengagement from irrelevant objects after they have captured attention.

The processes of target selection, distractor suppression, and distractor disengagement are difficult to tease apart using only behavioral measures. Nonetheless, recent research has identified a set of lateralized event-related potential (ERP) components that may provide dissociable measures of these processes. The first of these is the N2pc component, defined as an increased negative voltage at posterior electrodes contralateral to an attended stimulus. Accumulating evidence suggests that the N2pc indexes the shift of visual attention onto an attended object [@dellacqua_spatial_2006;@hickey_electrophysiological_2006;@luck_spatial_1994]. N2pc amplitude has also been used as a measure of attentional capture by relevant stimuli [@kiss_attentional_2008], or pop-out objects [@eimer_attentional_2007;@holguin_n2pc_2009]. Here we took advantage of the contralateral control method in order to measure the N2pc elicited separately by targets and distractors [@hickey_electrophysiological_2009;@hilimire_dynamics_2011;@hilimire_event-related_2014]. This method provided us with independent measures of N2pc to targets, reflecting target selection, and N2pc to distractors, reflecting initial distractor capture. 

The second identified lateralized ERP component is an enhanced positivity contralateral to distracting or irrelevant objects [@hickey_electrophysiological_2009;@hilimire_competitive_2009;@toffanin_p4pc:_2011]. Research by @hickey_electrophysiological_2009 concluded that this component was a positivity related to distractor processing, thus they referred to it as 'Pd'. Similarly, @hilimire_target_2012 suggest that the component reflects distractor suppression during the disambiguation of target features. A similar (or possibly identical) positive component referred to as "Ptc", to reflect its temporal and contralateral scalp distribution has been identified in research by @hilimire_competitive_2009. Subsequent experiments have suggested that Ptc, like Pd, appears to reflect distractor suppression [@hilimire_dynamics_2011;@hilimire_event-related_2010]. However, evidence that both Pd and Ptc can sometimes be elicited by target objects suggests that Pd and Ptc may more generally reflect attentional disengagement from an attended stimulus [@burra_distractor_2014;@hilimire_event-related_2014;@sawaki_common_2012].

In this study, we measured lateralized ERPs separately for targets and distractors during the delay period of a working memory task. By varying the load on the working memory portion of the task, we were able to test specific predictions regarding the attentional mechanism that is affected by reduced working memory availability. Given that N2pc reflects attentional processing of an object, we predicted that the effect of working memory availability on target selection would be reflected in modulations of the target N2pc. The effect of working memory availability on distractor capture, on the other hand, would be reflected in a modulation of the distractor N2pc. Finally, given that Ptc reflects stimulus disengagement, the effect of working memory availability on distractor disengagement would be reflected in a modulation of the distractor Ptc under varying working memory load.

## Methods

### Participants.

22 individuals (8 males) between the ages of 18 and 29 (M = 22.09 years, SD = 3.13) participated in the experiment and were reimbursed with an NZD $10 voucher. All participants reported that they had normal or corrected-to-normal vision. All participants gave written, informed consent prior to the start of the experiment and the research was approved by the University of Auckland Human Participants Ethics Committee.

### Procedure.

Testing took place in a dimly lit, electrically shielded chamber. Experimental stimuli were presented on an LCD computer monitor (Samsung Sync Master P2270), with screen dimensions of 47.7 x 26.8cm and a resolution of 1920 x 1080 pixels. The participant was positioned 57cm away from the monitor with the viewing distance maintained through the use of a chinrest. E-prime software (version 2.0.8.74, Psychology Software Tools) was used to control stimulus presentation, synchronize stimulus presentation with the electrophysiological recording, and record participant responses. Participants performed a dual task that consisted of a working memory task interspersed with a selective attention task. In the working memory task participants encoded either one or two shapes at the start of a trial that they had to match to a test display after some delay. During the delay period of the working memory task, participants performed 4 visual searches in a series of target-decoy displays modified from those used in @hilimire_dynamics_2011. Each block consisted of 8 trials (8 working memory trials, 32 visual searches) and all participants completed a practice block followed by 18 testing blocks. This resulted in a total of 144 working memory trials and 576 visual search trials for analysis. Participants had a minimum 30-second break between each block and on half of the breaks they could choose to take a longer break.

Each trial began with a fixation cross on screen for 1500ms, and then the working memory cue appeared for 1000ms. In half of the trials, the cue would point either up or down (with equal probability) indicating that participants should encode either the top or bottom object which therefore results in a low load trial. In the other half of trials, the cue would point both up and down indicating that participants should encode both of the objects which therefore results in a high load trial. The working memory encode display would then be presented for 2000ms and participants had to encode the shape(s) indicated by the cue.

At this point, the visual search task would begin, first with a fixation cross presented for between 500 and 1500ms (randomly selected on each trial), followed by the presentation of the visual search display which appeared for 200ms. Participants had 1600ms to respond to the orientation of the target letter. If the colored T was upright they would press '1' on a standard keyboard numpad with their right hand, whereas if the T was rotated 180$^\circ$ then they would press '2'. Participants were instructed to respond as quickly as possible while attempting to maintain their accuracy above 90%. The visual search portion of the task was repeated 4 times in each trial.

Once the 4th visual search was completed, the working memory retrieval display would appear on screen for 2000ms and participants had to press 'm' with their left hand if the shape(s) on screen matched the encoded shape(s), or 'x' if it did not. The shapes matched on half of the trials. Finally, participants received feedback on the working memory portion of the task with a 1000ms display of either "Correct!", "Wrong", or "Too Slow" depending on their response. For an example trial, see figure\ \@ref(fig:TrialExample).

```{r TrialExample, fig.cap = "Example of a single trial of the experiment. This example shows a high-load condition, as indicated by the double-headed arrow cue pointing to both locations. In a low load trial, the arrow cue would point at only one of the possible locations.", fig.align = "center"}
include_graphics("Figures/TrialExample.pdf", auto_pdf = TRUE)
```

### Stimuli.

All stimuli were presented on a black background, and a gray fixation cross (0.2$^\circ$ x 0.2$^\circ$) was maintained in the center of the screen throughout the trial. The working memory cue consisted of a gray vertical arrow (0.4$^\circ$ x 1.5$^\circ$) which replaced the fixation cross and pointed either up, down, or both up and down. The working memory encoding and retrieval displays consisted of two colored shapes (each 1.2$^\circ$ x 1.2$^\circ$) presented on the midline, one centered 2.5$^\circ$ above and one centered 2.5$^\circ$ below the fixation cross. These stimuli could be one of four shapes (triangle, square, circle, diamond) in one of four colors (green, blue, orange, pink) however the two stimuli were never the same shape or color on a given trial. The visual search displays consisted of 16 letters (Ts and Ls; 0.6$^\circ$ x 0.6$^\circ$) arranged in equal intervals around an imaginary circle centered on the fixation cross with a radius of 3$^\circ$. Fourteen of the letters were gray Ts randomly rotated 90$^\circ$ to either the left or the right. The remaining two letters were a colored T (the target) and a colored L (the distractor). The target was randomly selected to be either green or orange on each trial, and the distractor was always the color not selected for the target. The target and distractor were randomly selected to be either upright or rotated by 180$^\circ$ on each trial, independent of one another. One of these two objects was always placed on the midline (half of the time the target, half of the time the distractor) while the other was lateralized to the left or right but always in the same visual field (upper or lower) as the midline object. This ensured that there was only ever one salient lateralized object for the calculation of lateralized ERPs. The physical luminance of the gray (23.6 cd/m$^2$), green (23.2 cd/m$^2$), red (23.1 cd/m$^2$), blue (23.8cd/m$^2$), orange (24.1 cd/m$^2$), and pink (24.4 cd/m$^2$) colors was equalized using a Konica Minolta LS-100 luminance meter.

### Electrophysiological recording.

EEG activity was recorded continuously at 1000Hz on an Electrical Geodesics Inc. (EGI) Hydrocel-GSN-128-channel Ag/AgCl electrode net (Electrical Geodesics Inc., Eugene, OR, USA). The electrodes have a geodesic arrangement and extend inferior to the axial plane containing F9/10 in the 10-10 system. The online reference electrode is Cz (placed on the vertex) and a COM sensor is located on the z-axis between Pz and POz equivalents. EEG activity was amplified with an EGI net amps 400 amplifier with 24-bit A/D conversion, an input impedance of $\ge$ 200 $\text{M}\Omega$, and a 4kHz antialiasing filter (500Hz low pass cut off). Electrode impedance levels were kept below 40$\text{k}\Omega$ and EGI's implementation of the driven common technique (Common Active Noise Sensing and Limiting) was used throughout.

### EEG Processing.

```{r ERP_Plots, include=FALSE}
erpData <-read.table("Data/SL_Average_ERP_Data.txt", header = TRUE)
#Convert to long table format
longERP = melt(erpData, id="xAxis")
#Create variables
longERP$Stimulus <- substr(longERP$variable,start=1,stop=1)
longERP$Component <- substr(longERP$variable,start=3,stop=7)
longERP$Load <- substr(longERP$variable,start=9,stop=12)

longERP$Component[longERP$Component == "P1pcc"] <- "P1pc"
longERP$Component[longERP$Component == "N2pcc"] <- "N2pc"
longERP$Component[longERP$Component == "Ptccc"] <- "Ptc"

distERP = filter(longERP, Stimulus == "D")
distERP$Component_f <- factor(distERP$Component, levels=c("N2pc", "Ptc", "SPCNa", "SPCNb"))
distPlot <- ggplot(data=distERP, aes( x=xAxis,y=value, group=Load)) +
  geom_rect(data = subset(distERP, Component  == "N2pc"), aes(xmin=208, xmax=256, ymin=-1, ymax=1), color="transparent", fill="orange", alpha=0.3) +
  geom_rect(data = subset(distERP, Component  == "Ptc"), aes(xmin=296, xmax=360, ymin=-1, ymax=1), color="transparent", fill="orange", alpha=0.3) +
  geom_rect(data = subset(distERP, Component  == "SPCNa"), aes(xmin=532, xmax=596, ymin=-1, ymax=1), color="transparent", fill="orange", alpha=0.3) +
  geom_rect(data = subset(distERP, Component  == "SPCNb"), aes(xmin=700, xmax=728, ymin=-1, ymax=1), color="transparent", fill="orange", alpha=0.3) +
  geom_line(aes(linetype=Load), size=1) +
  scale_x_continuous(name ="Latency (ms)") +
  scale_y_continuous(name =expression(paste("Amplitude (",mu,"v)"))) +
  facet_grid(Component_f~.) +
  theme_apa()


targERP = filter(longERP, Stimulus == "T")
targERP$Component_f <- factor(targERP$Component, levels=c("P1pc", "N2pc", "SPCNa", "SPCNb"))
targPlot <- ggplot(data=targERP, aes( x=xAxis,y=value, group=Load)) +
  geom_rect(data = subset(targERP, Component  == "P1pc"), aes(xmin=156, xmax=180, ymin=-1, ymax=1), color="transparent", fill="orange", alpha=0.3) +
  geom_rect(data = subset(targERP, Component  == "N2pc"), aes(xmin=208, xmax=252, ymin=-1, ymax=1), color="transparent", fill="orange", alpha=0.3) +
  geom_rect(data = subset(targERP, Component  == "SPCNa"), aes(xmin=380, xmax=488, ymin=-1, ymax=1), color="transparent", fill="orange", alpha=0.3) +
  geom_rect(data = subset(targERP, Component  == "SPCNb"), aes(xmin=676, xmax=700, ymin=-1, ymax=1), color="transparent", fill="orange", alpha=0.3) +
  geom_line(aes(linetype=Load), size=1) +
  scale_x_continuous(name ="Latency (ms)") +
  scale_y_continuous(name =expression(paste("Amplitude (",mu,"v)"))) +
  facet_grid(Component_f~.) +
  theme_apa()

pdf("Figures/SAWMLOAD_distERPs.pdf", width = 7, paper = "special")
distPlot
dev.off()

pdf("Figures/SAWMLOAD_targERPs.pdf", width = 7, paper = "special")
targPlot
dev.off()
```

```{r distERPs, fig.cap = "Subtracted event-related potentials showing the lateralized response to distractors under high and low load. Each component was calculated from the average of a slightly different cluster of electrodes (based on the condition averaged scalp topography of that component's time window).", fig.align = "center"}
include_graphics("Figures/SAWMLOAD_distERPs.pdf", auto_pdf = TRUE)
```

```{r targERPs, fig.cap = "Subtracted event-related potentials showing the lateralized response to targets under high and low load. Each component was calculated from the average of a slightly different cluster of electrodes (based on the condition averaged scalp topography of that component's time window).", fig.align = "center"}
include_graphics("Figures/SAWMLOAD_targERPs.pdf", auto_pdf = TRUE)
```

EEG data were processed twice, firstly in a way which was optimized for the performance of independent component analysis (ICA), and secondly in a way which was optimized for the production of ERP components. ICA weights from the first set of data could then be copied across in order to perform artefact correction in the ERP data. All EEG preprocessing was performed using MATLAB (2017a, The Mathworks Inc.) and the EEGLAB toolbox [@DELORME2004].

For the performance of ICA, data were down-sampled to 250 Hz. Data were bandpass filtered from 1 to 30Hz using a Butterworth filter implemented in ERPLAB [@ERPLAB]. Channel locations were loaded. Bad channels were detected, removed, and replaced with a spherical interpolation of surrounding electrodes. Data were then re-referenced to the average of all electrodes. ICA was then performed on the data, using the PCA option to reduce dimensions to account for the number of interpolated channels. ICA weights were then stored in order to be applied to data which had been pre-processed for the production of ERPs. For the production of ERPs, data were first down-sampled to 250Hz. Data were bandpass filtered from 0.1 to 30Hz using a Butterworth filter implemented in ERPLAB [@ERPLAB]. Channel locations were loaded. Bad channels were detected, removed, and replaced with a spherical interpolation of surrounding electrodes. Data were then re-referenced to the average of all electrodes. Data were then epoched from 200ms pre-stimulus to 800ms post-stimulus around the onset of the visual search displays. Epochs containing horizontal eye movements were removed (identified as any epoch containing a greater than 32 microvolt difference between electrodes location at the outer canthi of each eye). ICA weights were then copied over to this set of data in order to perform artefact correction. The ADJUST toolbox was used in order to identify artefact components [@ADJUST_tb]. All components identified as artefacts by ADJUST were removed from the data. Subsequently, epochs which contained any activity above 100 microvolts or below -100 microvolts were removed from the data. Participants with less than 60% of their trials remaining at this point were rejected, resulting in 2 rejections.

In order to isolate activity elicited contralateral to the lateralized object, all trials containing a right visual field target or distractor had their EEG activity flipped along the longitudinal axis such that for all trials, right hemisphere electrodes now represent activity contralateral to the lateralized stimulus and left hemisphere electrodes represent activity ipsilateral to the lateralized object. Ipsilateral activity was then subtracted from both hemispheres and the remaining contralateral activity was then mirrored onto the left hemisphere. At this stage, scalp activity represents only that portion of the EEG signal which is greater contralateral to the lateralized stimulus, mirrored onto both sides of the scalp. Importantly for our results, this means that in target lateralized trials (in which the distractor is on the midline), activity elicited by the distractors is subtracted out of the data and only target related activity remains. Conversely, in the distractor lateralized trials (in which the target is on the midline), activity elicited by targets has been removed.

Participant averages were formed separately for lateralized target and lateralized distractor trials and global field power (GFP) was then calculated for each of these conditions (across all electrodes posterior to Cz). In order to find unbiased estimates of the component latencies and their widths, Matlab's built-in findpeaks function was used to detect the five most prominent peaks in the GFP for each stimulus type as well as their widths (using half-prominence). If any of these peaks overlapped with the pre-stimulus period then they were ignored, leaving 4 components of interest for both the target and the distractor lateralized conditions. Electrode clusters were then selected for each component by averaging across working memory load and plotting the topographies for each window. Electrode selection was similar for all components and centered around P7/8. For the targets, an early positivity (156 to 180ms), followed by three negativities (208 to 252ms, 380 to 488ms, and 676 to 700ms). The latencies and scalp distributions of these components line up with the P1pc, N2pc, and two parts of the SPCN component, as a result, we will refer to them as the P1pc, N2pc, SPCNa, and SPCNb (shown in figure\ \@ref(fig:targERPs)). For the distractors, this method identified an initial negativity (208 to 256ms), followed by a positivity (296 to 360ms), followed by two negativities (532 to 596ms, and 700 to 728ms). These latencies and scalp distributions are consistent with the N2pc, Ptc, and two portions of the SPCN component and we will, therefore, refer to them as the N2pc, Ptc, SPCNa, and SPCNb (shown in figure\ \@ref(fig:distERPs)). For the individual differences analyses, we used a signed-area approach similar to that used by @gaspar_inability_2016 and @sawaki_common_2012. First, we calculated the positive and negative area across all components for targets and distractors under high and low load. In order to correct for the effect of noise in these estimates we followed the procedure of @gaspar_inability_2016 and subtracted the equivalent calculation taken from the baseline period in each condition (and in our case this value was multiplied in order to account for the different lengths of time between the baseline period and the area of the components).

### Statistical analysis.

All statistical analysis was performed in version 1.1.423 of RStudio [@rstudio_desk_2016] using `r cite_r("r-references.bib")`. The data and code used to generate this manuscript (including analyses and plots) can be found at https://osf.io/wm3t6/.

## Results

### Behavioral measures.

```{r behavioral_stats, include=FALSE}
wmAcc_out <- t.test(behavData$WM_High_Acc, behavData$WM_Low_Acc, paired = TRUE, alternative = "two.sided")
wmRT_out <- t.test(behavData$WM_High_RT,  behavData$WM_Low_RT, paired = TRUE, alternative = "two.sided")
vsAcc_out <- t.test(behavData$VS_High_Acc, behavData$VS_Low_Acc, paired = TRUE, alternative = "two.sided")
vsRT_out <- t.test(behavData$VS_High_RT, behavData$VS_Low_RT, paired = TRUE, alternative = "two.sided")

#Make violin plot data
WMRT = filter(longBehav, Task == "WM" & Measure == "RT")
WMAcc = filter(longBehav, Task == "WM" & Measure == "Acc")
VSRT = filter(longBehav, Task == "VS" & Measure == "RT")
VSAcc = filter(longBehav, Task == "VS" & Measure == "Acc")

# Create violin plots
WMRT.violin <- ggplot(data=WMRT, aes( x=Load,y=value)) +
  geom_violin(trim=FALSE, fill="gray") +
  labs( y = "Working memory RT (ms)") +
  #ylim(50,100) +
  #geom_dotplot(binaxis='y', stackdir='center', dotsize=1) +
  geom_boxplot(width=0.1) +
  theme_apa()
WMAcc.violin <- ggplot(data=WMAcc, aes( x=Load,y=value)) +
  geom_violin(trim=FALSE, fill="gray") +
  labs( y = "Working memory Acc (%)") +
  ylim(50,100) +
  #geom_dotplot(binaxis='y', stackdir='center', dotsize=1) +
  geom_boxplot(width=0.1)+
  theme_apa()
VSRT.violin <- ggplot(data=VSRT, aes( x=Load,y=value)) +
  geom_violin(trim=FALSE, fill="gray") +
  labs( y = "Visual Search RT (ms)") +
  #ylim(50,100) +
  #geom_dotplot(binaxis='y', stackdir='center', dotsize=1) +
  geom_boxplot(width=0.1)+
  theme_apa()
VSAcc.violin <- ggplot(data=VSAcc, aes( x=Load,y=value)) +
  geom_violin(trim=FALSE, fill="gray") +
  labs( y = "Visual Search Acc (%)") +
  ylim(50,100) +
  #geom_dotplot(binaxis='y', stackdir='center', dotsize=1) +
  geom_boxplot(width=0.1) +
  theme_apa()
pdf("Figures/behavViolinPlot.pdf", width = 7, paper = "special")
plot_grid(WMRT.violin, WMAcc.violin, VSRT.violin, VSAcc.violin, labels = c("A","B","C","D"))
dev.off()
```

```{r violinPlots, fig.cap = "Violin plots showing the effect of working memory load on A) Working memory response times, B) working memory accuracy, C) visual search response times, and D) visual search accuracy.", fig.align = "center"}
include_graphics("Figures/behavViolinPlot.pdf", auto_pdf = TRUE)
```

Mean response times and percent correct are shown as a function of working memory load for each task (working memory and visual search) in figure\ \@ref(fig:violinPlots). Paired samples T-tests were carried out to test the effect of working memory load on response times (ms) and accuracy (%) in both the working memory and visual search tasks. The results of the T-tests showed that the high-load condition did result in both significantly slower (`r apa_print(wmRT_out)$full`) and less accurate (`r apa_print(wmAcc_out)$full`) responses to the working memory task. The results also showed that participants were significantly slower on the visual search task under high working memory load (`r apa_print(vsRT_out)$full`) however there was no significant effect of working memory load on visual search accuracy (`r apa_print(vsAcc_out)$full`). These data confirm firstly that the working memory task effectively manipulated the load on a participant's working memory, and secondly that this manipulation also affected performance on a concurrent visual search task.

### Electrophysiological measures.

```{r Subtracted_ANOVA, echo=FALSE, warning =FALSE}
# Run the distractor ANOVA (two way, Load x Component on distractor amplitudes)
dist.aov <- aov_ez(
  data = longDist,
  dv = "value",
  id = "PID", 
  within = c("Load", "Component")
)
dist.load.emmeans <- emmeans(dist.aov, ~ Load)
dist.component.emmeans <- emmeans(dist.aov, ~ Component)
dist.interaction.load.emmeans <- emmeans(dist.aov, ~Load|Component)
dist.load.posthoc <- pairs(dist.load.emmeans)
dist.component.posthoc <- pairs(dist.component.emmeans)
dist.interaction.load.posthoc <- pairs(dist.interaction.load.emmeans)

# Descriptives for distractors
#summaryBy(value ~ Load + Component, data = longDist, FUN = function(x) { c(Mean = mean(x), SD = sd(x)) } )
dist.comp.d <- summaryBy(value ~ Component, data = longDist, FUN = function(x) { c(Mean = mean(x), SD = sd(x)) } )
dist.load.d <- summaryBy(value ~ Load, data = longDist, FUN = function(x) { c(Mean = mean(x), SD = sd(x)) } )

targ.aov <- aov_ez(
  data = longTarg,
  dv = "value",
  id = "PID",
  within = c("Load", "Component")
)
targ.component.emmeans <- emmeans(targ.aov, ~ Component)
targ.component.posthoc <- pairs(targ.component.emmeans)

# ANOVA tanles
dist.result <- apa_print(dist.aov)
targ.result <- apa_print(targ.aov)

# Follow-up tables
targ.component.posthoc.table <- xtable(summary(targ.component.posthoc), caption = "Summary of the posthoc comparisons used to follow up the main effect of component on the lateraliesd neural response to targets during visual search.", label = "tab:followupTargetComponentTable")
dist.component.posthoc.table <- xtable(summary(dist.component.posthoc), caption = "Summary of the posthoc comparisons used to follow up the main effect of component on the lateraliesd neural response to targets during visual search.", label = "tab:componentMainEffectDistractors")
dist.interaction.load.posthoc.table <- xtable(summary(dist.interaction.load.posthoc), caption = "Pairwise comparisons showing the effect of load on each component elicited by lateralized distractors using Tukey correction.", label = "tab:dableLabel")
```

```{r targANOVATable, results = 'asis'}
apa_table(targ.result$table, caption = "Summary of the 2 x 4 repeated measures ANOVA used to test the effects of working memory load and component on the lateraliesd neural response to targets during visual search.", escape = FALSE)
```

```{r targANOVAcomponentTable, results = 'asis'}
print(targ.component.posthoc.table, comment=FALSE, caption.placement = "top", latex.environments="flushleft")
```

In order to test for the effect of working memory load on lateralized ERP components related to target and distractor processing, two repeated measures ANOVAs were performed. For lateralized targets, the repeated measures factors were working memory load (high and low), and target component (P1pc, N2pc, SPCNa, and SPCNb) whereas for lateralized distractors the repeated measures factors were working memory load (high and low), and distractor component (N2pc, Ptc, SPCNa, and SPCNb). Greenhouse-Geisser corrected values are used in all cases. The results for targets showed a significant main effect of component (`r targ.result$full$Component`), but no significant main effect of working memory load (`r targ.result$full$Load`), nor any significant interaction between working memory load and component (`r targ.result$full$Load_Component`). Pairwise comparisons using Tukey correction were performed in order to follow up the main effect of component. The results showed that the P1pc is significantly more positive in amplitude (M = 0.55, SE = 0.09) when compared to the N2pc (M = -0.71, SE = 0.15,  p <  0.001), SPCNa (M = -1.22, SE = 0.19, p < 0.001), and SPCNb (M = -0.77, SE = 0.13, p < 0.001). The N2pc is significantly smaller in amplitude than the SPCNa (p < 0.001), but there is no significant difference in comparison to the SPCNb (p > 0.05). Finally, there is also no significant difference between SPCNa and SPCNb (p > 0.05). Full results shown in table\ \@ref(tab:followupTargetComponentTable).

```{r distANOVATable, results='asis'}
apa_table(dist.result$table, caption = "Summary of the 2 x 4 repeated measures ANOVA used to test the effects of working memory load and component on the lateralized neural response to distractors in the visual search task.", escape = FALSE)
```

```{r SAWMLoad_tab1, results='asis'}
print(dist.component.posthoc.table, comment=FALSE, caption.placement = "top", latex.environments="flushleft")
```

```{r SAWMLoad_tab2, results = 'asis'}
print(dist.interaction.load.posthoc.table, comment=FALSE, caption.placement = "top", latex.environments="flushleft")
```

The results for distractors showed a significant main effect of component (`r dist.result$full$Component`), and a significant main effect of working memory load (`r dist.result$full$Load`) indicating that the response to distractors under high load is significantly more negative (M =`r printnum(dist.load.d$value.Mean[dist.load.d$Load == "High"])`, SD = `r printnum(dist.load.d$value.SD[dist.load.d$Load == "Low"])`) than the response to distractors under low load (M = `r printnum(dist.load.d$value.Mean[dist.load.d$Load == "Low"])`, SD = `r printnum(dist.load.d$value.SD[dist.load.d$Load == "Low"])`). There was no significant interaction between working memory load and component (`r dist.result$full$Load_Component`). Pairwise comparisons using Tukey correction were performed in order to follow up the main effect of component. The results showed that the Ptc is significantly more positive in amplitude (M = 0.75, SE = 0.13) when compared to the N2pc (M = -0.63, SE = 0.09,  p <  0.001), SPCNa (M = -0.74, SE = 0.13, p < 0.001), and SPCNb (M = -0.56, SE = 0.11, p < 0.001). There were no other significant differences between the N2pc, SPCNa, and SPCNb (see table\ \@ref(tab:componentMainEffectDistractors)). In order to check for specifity of the effect we performed pairwise comparisons which compared the amplitude of each component under high versus low load. These comparisons suggest that the only component which was significantly affected by working memory load was the Ptc which was smaller under high load (see table\ \@ref(tab:dableLabel)) however the lack of an interaction between load and component in the ANOVA suggests this specific effect could be accounted for by a generally more positive lateralized response to the distractor under low load.

```{r latencyTtests}
LDistP.minus.HDistP.D <- mean(lowLatData$LDist_PLat-highLatData$HDist_PLat)
LDistP.minus.HDistP.se <- sqrt((19/20)*sum(((lowLatData$LDist_PLat-highLatData$HDist_PLat)-LDistP.minus.HDistP.D)^2))
LDistP.minus.HDistP.T <- LDistP.minus.HDistP.D/LDistP.minus.HDistP.se
```

```{r latcorrelograms, echo=FALSE, warning=FALSE, include=FALSE}
latColumns <- c("WMAcc", "WMRT", "VSAcc", "VSRT", "DistPLat", "TargPLat", "DistNLat", "TargNLat")
colnames(lowLatData) <- latColumns
colnames(highLatData) <- latColumns

low.lat.corr <- rcorr(as.matrix(lowLatData))
high.lat.corr <- rcorr(as.matrix(highLatData))
colnames(low.lat.corr$r) <- latColumns
colnames(high.lat.corr$r) <- latColumns
rownames(low.lat.corr$r) <- latColumns
rownames(high.lat.corr$r) <- latColumns
pdf("Figures/lowLatCorrelogram.pdf", width = 7, paper = "special")
corrplot(low.lat.corr$r, method = "ellipse", type = "lower",p.mat = low.lat.corr$P, sig.level = 0.05, insig = "blank")
dev.off()
pdf("Figures/highLatCorrelogram.pdf", width = 7, paper = "special")
corrplot(high.lat.corr$r, method = "ellipse", type = "lower",p.mat = high.lat.corr$P, sig.level = 0.05, insig = "blank")
dev.off()

# Scatterplot
WMAccbyDISTPLat <- ggplot(lowLatData, aes(x=WMAcc, y=TargNLat)) +geom_point() +geom_smooth(method=lm) +theme_apa()
WMAccbyDISTNLat <- ggplot(lowLatData, aes(x=WMAcc, y=DistNLat)) +geom_point() +geom_smooth(method=lm) +theme_apa()
WMRTbyTARGNLat <- ggplot(lowLatData, aes(x=WMRT, y=TargPLat)) +geom_point() +geom_smooth(method=lm) +theme_apa()
highWMAccbyDISTNLat <- ggplot(highLatData, aes(x=WMAcc, y=TargNLat)) +geom_point() +geom_smooth(method=lm) +theme_apa()
pdf("Figures/lowLatScatterPlot.pdf", width = 7, paper = "special")
plot_grid(WMAccbyDISTPLat,WMAccbyDISTNLat,WMRTbyTARGNLat,highWMAccbyDISTNLat, labels = c("A","B","C","D"))
dev.off()

```

```{r lowLatScatterGraphing, fig.cap = "This is where I'd put the figure caption.", fig.align = "center"}
#include_graphics("Figures/lowLatScatterPlot.pdf", auto_pdf = TRUE)
```

```{r correlogramLowLat, fig.cap = "This is where I'd put the figure caption lowLat.", fig.align = "center"}
#include_graphics("Figures/lowLatCorrelogram.pdf", auto_pdf = TRUE)
```

```{r correlogramHighLat, fig.cap = "This is where I'd put the figure caption highLat.", fig.align = "center"}
#include_graphics("Figures/highLatCorrelogram.pdf", auto_pdf = TRUE)
```

\begin{table}[h]
	\begin{flushleft}
	\caption{Comparison of the effect that working memory load has on the amplitude of target-lateralised components using Bayesian Paired Samples T-Test}
	\label{tab:SL_BayesTargFollowup}
	\begin{tabular}{lrrrrr}
		\hline
		 &  &  & BF$_{1}$$_{0}$ & BF$_{0}$$_{1}$ & error \%  \\
		\hline
		High Load P1pc & - & Low Load P1pc & 0.379 & 2.636 & 0.021  \\
		High Load N2pc & - & Low Load N2pc & 0.240 & 4.175 & 0.003  \\
		High Load SPCN & - & Low Load SPCN & 0.232 & 4.304 & 0.006  \\
		High Load SPCN2 & - & Low Load SPCN2 & 0.883 & 1.133 & 0.005  \\
		\hline
	\end{tabular} 
	\end{flushleft}
\end{table}

\begin{table}[h]
	\begin{flushleft}
	\caption{Comparison of the effect that working memory load has on the amplitude of distractor-lateralised components using Bayesian Paired Samples T-Test}
	\label{tab:SL_BayesDistFollowup}
	\begin{tabular}{lrrrrr}
		\hline
		 &  &  & BF$_{1}$$_{0}$ & BF$_{0}$$_{1}$ & error \%  \\
		\hline
		High Load N2pc & - & Low Load N2pc & 0.279 & 3.588 & 0.021  \\
		High Load Ptc & - & Low Load Ptc & 3.304 & 0.303 & 0.003  \\
		High Load SPCN & - & Low Load SPCN & 0.621 & 1.611 & 0.006  \\
		High Load SPCN2 & - & Low Load SPCN2 & 0.646 & 1.547 & 0.005  \\
		\hline
	\end{tabular} 
	\end{flushleft}
\end{table}

To increase the specificity of our inferences we ran some bayesian folloW-up tests. Bayesian analyses allow us to quantify the evidence we have in favor of the null hypothesis (compared to the alternative), rather than just the probability of observing differences as extreme as those in our data given that the null hypothesis is true. As a result, we are able to estimate the probability that there is no effect of load on each component, rather than simply concluding that we have insufficient evidence to show that there was an effect. We used Bayesian paired samples \textit{t}-tests in order to compare component amplitude under high versus low load, and each \textit{t}-test was run with the default Cauchy scale (\textit{r} = 0.707, @R-BayesFactor). We did this for each component elicited by lateralized targets (as shown in table 15), as well as each component elicited by lateralized distractors (shown in table table 16). The results mirrored the results of the ANOVA above in showing that the only component which was affected by concurrent working memory load was the Ptc elicited by distractors. For all other components, the probability of there being no effect of working memory load was higher when compared to the probability of an effect of concurrent working memory load. Although the probabilities range from anecdotal to moderate, they provide increased confidence that working memory load has no effect on lateralized components other than the distractor Ptc. 

## Discussion

The aim of this research was to specify the relationship between selective attention and working memory using neural indices of attentional control. Our results showed that within individuals, increased working memory load slowed responses on a concurrent visual search task. The lateralized neural response to targets and distractors in the visual search displays showed that this appeared to be the result of changes in the way salient distractors were processed as working memory load increased. Target processing, on the other hand, appeared unaffected by working memory load. The presence of a main effect of load on distractors, but no interaction between load and component means that it is difficult to specify the attentional process (whether capture by distractors, or disengagement from distractors) being impacted. Follow-up analyses suggest that the best candidate is the distractor Ptc which indexes distractor disengagement and is significantly reduced under high working memory load. Taken together, these results support the idea that working memory load specifically impacts an individual's ability to disengage from salient distractors, and that failure to efficiently disengage from distractors is responsible for the behavioral impairments observed under increasing working memory load [@fukuda_individual_2011].

The effect of working memory load on the neural response to distractors raises some interesting questions about the dynamics of lateralized positivities recorded in this task and others. Our results showed that as working memory load was increased, the neural response to distractors became less positive across all four of the components we measured. If each of these components reflects an independent stage of processing [@hickey_electrophysiological_2009;@Gaspar5658;@hilimire_dynamics_2011], then one explanation for our result is that increased working memory load impacted on distractor capture, distractor disengagement, and storage of distractor features in such a way that the neural index of these processes became less positive. When the components were tested individually, however, our data showed that only the Ptc was significantly modulated by working memory load. A parsimonious explanation for our results is that increased memory load impacted on the amplitude of the distractor Ptc, but that Ptc activity overlapped in time with the other components of the average ERP. Thus, any modulation of Ptc amplitude would be observed not only at the peak of the Ptc itself, but in the amplitude of all overlapping activity. The apparent effect of overlap that we observe in our results raises the question of why overlap between components would be observed in our experiment when previous research has shown these components to be dissociable.

The reason for differences in the extent to which Ptc overlaps with other components depends on how Ptc manifests at the single trial level. A sustained positivity in the average ERP could reflect either a sustained positive component at the single trial level or variability in the latency of the component at the single trial level. In the former case, Ptc reflects the presence of a sustained lateralized positivity, the bulk of which is typically masked by a series of overlapping, punctuated, lateralized negativities. Differences across experiments in the extent of observable overlap could, therefore, be the result of differences in the proportion of negative to positive activity in the task. Alternatively, the lateralized positivity we recorded may be short in duration but highly variable in latency across trials, therefore the sustained positivity in the average waveform is the product of convolving this variable signal across the epoch. Differences in overlap across experiments, in this case, could instead be due to differences in the amount of latency variability induced by the specific task. In both cases, the interpretation of our results remains the same; that increased working memory load impacts specifically on the amplitude of the lateralized positivity to distractors, and that this reflects impairments of distractor disengagement. Our experiment didn't allow for teasing apart these two scenarios, nonetheless, our result does support the use of signed area approaches for quantifying the amplitude of these lateralized positivities as suggested by @sawaki_common_2012. Whether the lateralized positivity is a large sustained component or highly variable across trials, the signed-area approach would be well suited to capturing and quantifying its amplitude.

Unexpectedly we detected an early positivity in the lateralized response to targets. Although the P1pc has been observed in other paradigms, its functional role is less well understood. Current hypotheses to explain the occurrence of a P1pc don't seem to apply to our findings. One feature of visual search tasks that can elicit a P1pc is sensory imbalance across the visual display [@edwards_scalp_1987]. If a luminant stimulus is presented in one visual field without a luminance matched stimulus in the opposite visual field location then we would observe an increased P1 contralateral to the lateralized target. This would manifest in the lateralized ERPs as P1pc. In our task, all targets were presented opposite gray fillers which were physically matched for luminance. Although this is not guaranteed to prevent the target color from eliciting a larger P1, the lack of any P1pc for distractors in our task (which had the exact same colors as targets and in the same proportions) suggests that the P1pc is not a result of stimulus imbalance. Alternatively, growing evidence suggests that P1pc may be elicited in response to stimulus change [@verleger_time-course_2012]. Although the target color changed across trials in our study, this is unlikely to explain the P1pc in our task. First, because target color changed at the exact same frequency as distractor color which did not elicit a P1pc. Second, the target-decoy task used in our study is a replication of the task used by @hilimire_dynamics_2011 who did not record a P1pc to targets. The P1pc we observe in our task is, therefore, more likely to be a result of the concurrent working memory task.

The relationship between working memory and lateralized ERP components has been investigated previously using a between-subjects design [@gaspar_inability_2016]. In their experiment, participants performed a change detection task that was used to estimate their individual working memory capacity. Subsequently, participants performed a visual search task with display containing a uniquely colored target, amongst 14 homogeneously colored fillers, and one uniquely colored distractor. Target and distractor locations were arranged in such a way that only one of the objects was lateralized and therefore the lateralized response to targets and distractors could be dissociated. Their results showed that individual differences in working memory capacity were significantly correlated with the amplitude of the lateralized positivity to distractors. These results provide a between-subject complement to the results we have shown with our within-subjects design. In both cases, increased working memory availability is associated with an increased lateralized positivity to distractors. Both within-subject, and between-subject investigations of the role that working memory plays in the allocation of attention therefore support the suggestion that working memory is specifically important for the processing of distraction.

## Conclusion

This research attempted to answer the question of why working memory availability is important for selective attention. In summary, the results suggest that working memory availability enables individuals to disengage from salient distractors which have captured attention. Our findings are consistent with evidence from between-subject designs showing that individuals with low working memory capacity have specific impairments in distractor processing [@gaspar_inability_2016;@fukuda_individual_2011]. Our results extend this work to show that when working memory load is increased on an individual (and therefore their working memory availability is reduced), it is similarly their ability to disengage from salient distractors which is impaired. Our results also raise questions for future research about the extent and effect of overlap between lateralized ERP components, as well as the cause and the significance of an early lateralized positivity to targets. Taken together, the results suggest that a fruitful approach for characterizing the relationship between working memory and selective attention is to focus on the availability of working memory resources to unify between-subject and within-subject comparisons. We also demonstrate the utility of lateralized event-related potentials in teasing apart sub-processes of selective attention which are difficult to dissociate behaviorally.

